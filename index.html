<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<title>CLC2018 → Palette d’autore (Mobile)</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<link rel="stylesheet" href="https://js.arcgis.com/4.33/esri/themes/light/main.css" />
<script src="https://js.arcgis.com/4.33/"></script>
<style>
  :root{
    --panel-w: 420px;
    --panel-pad: 10px;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
  }
  html, body, #viewDiv { height:100%; margin:0; }
  body{ font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }

  /* Bottone flottante per aprire/chiudere il pannello (mobile friendly) */
  .fab{
    position: absolute; z-index: 20;
    top: calc(8px + var(--safe-top)); left: 8px;
    width: 40px; height: 40px; border-radius: 20px;
    display:flex; align-items:center; justify-content:center;
    background: #fff; border: 1px solid #0002; box-shadow: 0 2px 8px rgba(0,0,0,.15);
    font-size: 20px; cursor: pointer; user-select: none;
  }

  /* Pannello a cassetto */
  .panel{
    position: absolute; z-index: 15;
    background: rgba(255,255,255,.98);
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(0,0,0,.18);
    padding: var(--panel-pad);
    width: var(--panel-w);
    max-height: 70vh;
    overflow: auto;
  }
  /* Desktop: in alto a sinistra non invasivo */
  @media (min-width: 801px){
    .panel{ top: calc(10px + var(--safe-top)); left: 10px; }
  }
  /* Mobile: cassetto in basso centrato */
  @media (max-width: 800px){
    .panel{
      width: min(92vw, 520px);
      left: 50%; transform: translateX(-50%);
      bottom: calc(8px + var(--safe-bottom));
      max-height: 55vh;
    }
  }

  .row{ display:flex; gap:6px; margin:6px 0; align-items:center; }
  .row label{ min-width:110px; font-size: 13px; }
  input, select, button{ font-size: 14px; }
  textarea{ width:100%; height:120px; font:12px ui-monospace,Menlo,Consolas,monospace; }
  .title{ font-weight:600; margin-bottom:6px; }

  /* Legenda compatta, anch’essa comprimibile */
  #legendWrap{
    position: absolute; z-index: 12;
    right: 8px; bottom: calc(8px + var(--safe-bottom));
    background:#fff; border-radius:10px; padding:8px;
    box-shadow: 0 2px 8px rgba(0,0,0,.15); max-width: 300px; font-size:12px;
  }
  .legend-item{ display:flex; gap:8px; align-items:center; margin:4px 0; }
  .sw{ width:14px; height:14px; border:1px solid #0003; border-radius:2px; }
  .legend-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; font-weight:600; }
  .toggle{ border:none; background:#f3f3f3; border-radius:6px; padding:4px 8px; cursor:pointer; }

  /* Log compatto */
  #log{ font:12px ui-m